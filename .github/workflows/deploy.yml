name: Deploy

on:
  merge:
    branches:
      - master
      jobs:
        deploy:
          runs-on: self-hosted
          name: setup
          steps:
            - name: Install SSH Key
              uses: shimataro/ssh-key-action@v2
              with:
                key: ${{ secrets.SSH_PRIVATE_KEY }}
                known_hosts: 'just-a-placeholder-so-we-dont-get-errors'
            - name: Adding known hosts
              run: ssh-keyscan -p ${{secrets.SSH_SECRET_PORT }} -H {{ secrets.SSH_SECRET_HOST }} >> ~/.ssh/known_hosts
              run: ssh ${{secrets.SSH_SECRET_HOST}} -p ${{secrets.SSH_SECRET_PORT}} "git clone git@github.com:kragebein/bankid.git && cd bankid && docker build -t bankid && docker run -p 8080:8080 bankid -d"
              
